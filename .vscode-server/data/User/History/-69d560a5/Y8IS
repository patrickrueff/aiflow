import requests
import json
from datetime import datetime

def fetch_weather_data(api_key, cities):
    base_url = "https://api.openweathermap.org/data/2.5/weather"
    weather_data = []

    for city in cities:
        params = {
            'q': city,
            'appid': api_key
        }
        response = requests.get(base_url, params=params)
        if response.status_code == 200:
            # Ajoute directement les données de la ville à la liste
            weather_data.append(response.json())
        else:
            print(f"Failed to get data for {city}")

    return weather_data

def save_data_to_file(data, folder_path):
    timestamp = datetime.now().strftime("%Y-%m-%d %H:%M")
    filename = f"{timestamp}.json"
    filepath = f"{folder_path}/{filename}"

    with open(filepath, 'w') as file:
        json.dump(data, file, indent=4)

# Utilisation du script
api_key = '249cfd334e35c13468d7bb968c7bf6bb'  # Remplacez par votre clé API
cities = ['paris', 'london', 'washington']  # Modifiez la liste des villes si nécessaire
folder_path = "Airflow/raw_files"  # Chemin du dossier de destination

weather_data = fetch_weather_data(api_key, cities)
save_data_to_file(weather_data, folder_path)



